

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Unit Testing &mdash; BLT Tutorial Guide  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="BLT Tutorial Guide  documentation" href="index.html"/>
        <link rel="next" title="External Dependencies" href="external_dependencies.html"/>
        <link rel="prev" title="Portable compiler flags" href="using_flags.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> BLT Tutorial Guide
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup_blt.html">Setup BLT in your CMake Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_execs_and_libs.html">Creating Libraries and Executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_flags.html">Portable compiler flags</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Unit Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#google-test-c-c-tests">Google Test (C++/C Tests)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-blt-unit-test">Adding a BLT unit test</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests-and-examples">Running tests and examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-tests-within-blt">Configuring tests within BLT</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="external_dependencies.html">External Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_documentation.html">Creating Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BLT Tutorial Guide</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Unit Testing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/unit_testing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="unit-testing">
<span id="unittesting"></span><h1>Unit Testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h1>
<p>BLT has a built-in copy of the
<a class="reference external" href="https://github.com/google/googletest">Google Test framework (gtest)</a> for C and C++ unit tests and the
<a class="reference external" href="https://sourceforge.net/projects/fortranxunit/">Fortran Unit Test Framework (FRUIT)</a> for Fortran unit tests.</p>
<p>Each gtest or FRUIT file may contain multiple tests and is compiled into its own executable
that can be run directly or as a <code class="docutils literal"><span class="pre">make</span></code> target.</p>
<p>In this section, we give a brief overview of GTest and discuss how to add unit tests using the <code class="docutils literal"><span class="pre">blt_add_test</span></code> macro.</p>
<div class="section" id="google-test-c-c-tests">
<h2>Google Test (C++/C Tests)<a class="headerlink" href="#google-test-c-c-tests" title="Permalink to this headline">¶</a></h2>
<p>The contents of a typical Google Test file look like this:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="c1">#include &quot;gtest/gtest.h&quot;</span>

<span class="c1">#include ...    // include headers needed to compile tests in file</span>

<span class="o">//</span> <span class="o">...</span>

<span class="n">TEST</span><span class="p">(</span><span class="o">&lt;</span><span class="n">test_case_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">test_name_1</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">{</span>
   <span class="o">//</span> <span class="n">Test</span> <span class="mi">1</span> <span class="n">code</span> <span class="n">here</span><span class="o">...</span>
   <span class="o">//</span> <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="o">&lt;</span><span class="n">test_case_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">test_name_2</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">{</span>
   <span class="o">//</span> <span class="n">Test</span> <span class="mi">2</span> <span class="n">code</span> <span class="n">here</span><span class="o">...</span>
   <span class="o">//</span> <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">Etc</span><span class="o">.</span>
</pre></div>
</div>
<p>Each unit test is defined by the Google Test <code class="docutils literal"><span class="pre">TEST()</span></code> macro which accepts a
<em>test case name</em> identifier, such as the name of the C++ class being tested,
and a <em>test name</em>, which indicates the functionality being verified by the
test.  Within a test, failure of logical assertions (macros prefixed by <code class="docutils literal"><span class="pre">ASSERT_</span></code>)
will cause the test to fail immediately, while failures of expected values
(macros prefixed by <code class="docutils literal"><span class="pre">EXPECT_</span></code>) will cause the test to fail, but will
continue running code within the test.</p>
<p>Note that the Google Test framework will generate a <code class="docutils literal"><span class="pre">main()</span></code> routine for
each test file if it is not explicitly provided. However, sometimes it is
necessary to provide a <code class="docutils literal"><span class="pre">main()</span></code> routine that contains operation to run
before or after the unit tests in a file; e.g., initialization code or
pre-/post-processing operations. A <code class="docutils literal"><span class="pre">main()</span></code> routine provided in a test
file should be placed at the end of the file in which it resides.</p>
<p>Note that Google test is initialized before <code class="docutils literal"><span class="pre">MPI_Init()</span></code> is called.</p>
<p>Other Google Test features, such as <em>fixtures</em> and <em>mock</em> objects (gmock) may be used as well.</p>
<p>See the <a class="reference external" href="https://github.com/google/googletest/blob/master/googletest/docs/Primer.md">Google Test Primer</a>
for a discussion of Google Test concepts, how to use them, and a listing of
available assertion macros, etc.</p>
</div>
<div class="section" id="adding-a-blt-unit-test">
<h2>Adding a BLT unit test<a class="headerlink" href="#adding-a-blt-unit-test" title="Permalink to this headline">¶</a></h2>
<p>After writing a unit test, we add it to the project’s build system
by first generating an executable for the test using the <code class="docutils literal"><span class="pre">blt_add_executable()</span></code> macro.
We then register the test using the <code class="docutils literal"><span class="pre">blt_add_test()</span></code> macro.</p>
<div class="hint admonition">
<p class="first admonition-title">blt_add_test</p>
<p class="last">This macro generates a named unit test from an existing executable
and allows users to pass in command line arguments.</p>
</div>
<p>Returning to our running example (see  <a class="reference internal" href="creating_execs_and_libs.html#addtarget"><span class="std std-ref">Creating Libraries and Executables</span></a>),
let’s add a simple test for the <code class="docutils literal"><span class="pre">calc_pi</span></code> library,
which has a single function with signature:</p>
<blockquote>
<div><div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">double</span> <span class="n">calc_pi</span><span class="p">(</span><span class="nb">int</span> <span class="n">num_intervals</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>We add a simple unit test that invokes <code class="docutils literal"><span class="pre">calc_pi()</span></code>
and compares the result to <img class="math" src="_images/math/b7793e4f08d00aca47e272dcdfeb70f933dac222.png" alt="\pi"/>, within a given tolerance (<code class="docutils literal"><span class="pre">1e-6</span></code>).
Here is the test code:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;gtest/gtest.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;calc_pi.hpp&quot;</span><span class="cp"></span>

<span class="n">TEST</span><span class="p">(</span><span class="n">calc_pi</span><span class="p">,</span> <span class="n">serial_example</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">PI_REF</span> <span class="o">=</span> <span class="mf">3.141592653589793238462643</span><span class="p">;</span>
    <span class="n">ASSERT_NEAR</span><span class="p">(</span><span class="n">calc_pi</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="n">PI_REF</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To add this test to the build system, we first generate a test executable:</p>
<div class="highlight-cmake"><div class="highlight"><pre><span></span><span class="c">###############################################################################</span>
<span class="c"># Test 1: Creating an executable using gtest, using the executable via ctest.</span>
<span class="c">###############################################################################</span>
<span class="nb">blt_add_executable</span><span class="p">(</span> <span class="s">NAME</span> <span class="s">test_1</span>
                    <span class="s">SOURCES</span> <span class="s">test_1.cpp</span> 
                    <span class="s">DEPENDS_ON</span> <span class="s">calc_pi</span> <span class="s">gtest</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this test executable depends on two targets: <code class="docutils literal"><span class="pre">calc_pi</span></code> and <code class="docutils literal"><span class="pre">gtest</span></code>.</p>
<p>We then register this executable as a test:</p>
<div class="highlight-cmake"><div class="highlight"><pre><span></span><span class="nb">blt_add_test</span><span class="p">(</span> <span class="s">NAME</span> <span class="s">test_1</span> 
              <span class="s">COMMAND</span> <span class="s">test_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-tests-and-examples">
<h2>Running tests and examples<a class="headerlink" href="#running-tests-and-examples" title="Permalink to this headline">¶</a></h2>
<p>To run the tests, type the following command in the build directory:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ make test
</pre></div>
</div>
<p>This will run all tests through cmake’s <code class="docutils literal"><span class="pre">ctest</span></code> tool
and report a summary of passes and failures.
Detailed output on individual tests is suppressed.</p>
<p>If a test fails, you can invoke its executable directly to see the detailed
output of which checks passed or failed. This is especially useful when
you are modifying or adding code and need to understand how unit test details
are working, for example.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You can pass arguments to ctest via the <code class="docutils literal"><span class="pre">TEST_ARGS</span></code> parameter, e.g. <code class="docutils literal"><span class="pre">make</span> <span class="pre">test</span> <span class="pre">TEST_ARGS=&quot;...&quot;</span></code>
Useful arguments include:</p>
<table class="last docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-R</span></kbd></td>
<td>Regular expression filtering of tests.
E.g. <code class="docutils literal"><span class="pre">-R</span> <span class="pre">foo</span></code> only runs tests whose names contain <code class="docutils literal"><span class="pre">foo</span></code></td></tr>
<tr><td class="option-group">
<kbd><span class="option">-j</span></kbd></td>
<td>Run tests in parallel, E.g. <code class="docutils literal"><span class="pre">-j</span> <span class="pre">16</span></code> will run tests using 16 processors</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-V<var>V</var></span></kbd></td>
<td>(Very verbose) Dump test output to stdout</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="configuring-tests-within-blt">
<h2>Configuring tests within BLT<a class="headerlink" href="#configuring-tests-within-blt" title="Permalink to this headline">¶</a></h2>
<p>Unit testing in BLT is controlled by the <code class="docutils literal"><span class="pre">ENABLE_TESTS</span></code> cmake option and is on by default.</p>
<p>For additional configuration granularity, BLT provides configuration options
for the individual built-in unit testing libraries.  The following additional options are available
when <code class="docutils literal"><span class="pre">ENABLE_TESTS</span></code> is on:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">ENABLE_GTEST</span></code></dt>
<dd>Option to enable gtest (default: <code class="docutils literal"><span class="pre">ON</span></code>).</dd>
<dt><code class="docutils literal"><span class="pre">ENABLE_GMOCK</span></code></dt>
<dd>Option to control gmock (default: <code class="docutils literal"><span class="pre">OFF</span></code>).
Since gmock requires gtest, gtest is also enabled whenever <code class="docutils literal"><span class="pre">ENABLE_GMOCK</span></code> is true,
regardless of the value of <code class="docutils literal"><span class="pre">ENABLE_GTEST</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">ENABLE_FRUIT</span></code></dt>
<dd>Option to control FRUIT (Default <code class="docutils literal"><span class="pre">ON</span></code>). It is only active when <code class="docutils literal"><span class="pre">ENABLE_FORTRAN</span></code> is enabled.</dd>
</dl>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="external_dependencies.html" class="btn btn-neutral float-right" title="External Dependencies" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="using_flags.html" class="btn btn-neutral" title="Portable compiler flags" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, BLT Development Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>